<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>H·ªá th·ªëng Qu·∫£n l√Ω V√© T√†u</title>
<style>
:root {
  --primary: #0078d7;
  --primary-dark: #005fa3;
  --secondary: #ff6b35;
  --light: #f8f9fa;
  --dark: #343a40;
  --success: #28a745;
  --danger: #dc3545;
  --warning: #ffc107;
  --gray: #6c757d;
  --light-gray: #eef2f3;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #eef2f3 0%, #d9e4f5 100%);
  margin: 0;
  min-height: 100vh;
  color: var(--dark);
}

.hidden { display: none; }

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

/* Header */
header {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  text-align: center;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  border-radius: 0 0 15px 15px;
  margin-bottom: 30px;
}

header h1 {
  font-size: 2.2rem;
  margin-bottom: 10px;
}

header p {
  opacity: 0.9;
  font-size: 1.1rem;
}

/* Auth Screens */
.auth-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 70vh;
}

.auth-card {
  background: white;
  padding: 40px;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  width: 100%;
  max-width: 450px;
  text-align: center;
}

.auth-card h2 {
  color: var(--primary);
  margin-bottom: 10px;
  font-size: 1.8rem;
}

.auth-card p {
  color: var(--gray);
  margin-bottom: 30px;
}

.form-group {
  margin-bottom: 20px;
  text-align: left;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: var(--dark);
}

.form-group input, .form-group select {
  width: 100%;
  padding: 12px 15px;
  border: 1px solid #ddd;
  border-radius: 8px;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.form-group input:focus, .form-group select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(0, 120, 215, 0.2);
}

.btn {
  background: var(--primary);
  color: white;
  border: none;
  padding: 12px 20px;
  margin: 5px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
}

.btn:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.btn-secondary {
  background: var(--secondary);
}

.btn-secondary:hover {
  background: #e55a2b;
}

.btn-success {
  background: var(--success);
}

.btn-success:hover {
  background: #218838;
}

.btn-danger {
  background: var(--danger);
}

.btn-danger:hover {
  background: #c82333;
}

.btn-warning {
  background: var(--warning);
  color: var(--dark);
}

.btn-warning:hover {
  background: #e0a800;
}

.btn-sm {
  padding: 8px 15px;
  font-size: 0.9rem;
}

/* Cards */
.card {
  background: white;
  padding: 25px;
  margin: 20px 0;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
  transition: transform 0.3s ease;
}

.card:hover {
  transform: translateY(-5px);
}

.card h3 {
  color: var(--primary);
  margin-bottom: 20px;
  font-size: 1.4rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

/* Tables */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

th, td {
  border: 1px solid #ddd;
  padding: 12px;
  text-align: left;
}

th {
  background: var(--primary);
  color: white;
  font-weight: 600;
}

tr:nth-child(even) {
  background-color: #f8f9fa;
}

tr:hover {
  background-color: #e9ecef;
}

/* Status badges */
.status-badge {
  padding: 5px 10px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 600;
}

.status-pending {
  background: #fff3cd;
  color: #856404;
}

.status-paid {
  background: #d1edff;
  color: #0056b3;
}

.status-confirmed {
  background: #d4edda;
  color: #155724;
}

.status-active {
  background: #d4edda;
  color: #155724;
}

.status-inactive {
  background: #f8d7da;
  color: #721c24;
}

/* Tabs */
.tabs {
  display: flex;
  margin-bottom: 20px;
  border-bottom: 1px solid #ddd;
  flex-wrap: wrap;
}

.tab {
  padding: 12px 20px;
  cursor: pointer;
  font-weight: 600;
  border-bottom: 3px solid transparent;
  transition: all 0.3s ease;
}

.tab.active {
  border-bottom: 3px solid var(--primary);
  color: var(--primary);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* Stats */
.stats-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.stat-card {
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
  text-align: center;
}

.stat-card h4 {
  color: var(--gray);
  font-size: 1rem;
  margin-bottom: 10px;
}

.stat-card .value {
  font-size: 2rem;
  font-weight: 700;
  color: var(--primary);
}

/* Payment methods */
.payment-methods {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  margin: 20px 0;
}

.payment-method {
  flex: 1;
  min-width: 150px;
  border: 2px solid #ddd;
  border-radius: 10px;
  padding: 15px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
}

.payment-method:hover {
  border-color: var(--primary);
}

.payment-method.selected {
  border-color: var(--primary);
  background-color: rgba(0, 120, 215, 0.05);
}

.payment-method i {
  font-size: 2rem;
  margin-bottom: 10px;
  color: var(--primary);
}

/* Notification */
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 15px 20px;
  border-radius: 8px;
  color: white;
  font-weight: 600;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  transform: translateX(150%);
  transition: transform 0.4s ease;
}

.notification.show {
  transform: translateX(0);
}

.notification.success {
  background: var(--success);
}

.notification.error {
  background: var(--danger);
}

.notification.info {
  background: var(--primary);
}

/* Loading */
.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: white;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Form Grid */
.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

/* Seat Selection */
.seat-map {
  display: grid;
  grid-template-columns: repeat(10, 1fr);
  gap: 10px;
  margin: 20px 0;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 10px;
}

.seat {
  width: 40px;
  height: 40px;
  background: #28a745;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}

.seat:hover {
  transform: scale(1.1);
}

.seat.occupied {
  background: #dc3545;
  cursor: not-allowed;
}

.seat.selected {
  background: #ffc107;
  color: #000;
}

/* Responsive */
@media (max-width: 768px) {
  .container {
    padding: 10px;
  }
  
  .auth-card {
    padding: 25px;
  }
  
  .card {
    padding: 15px;
  }
  
  .stats-container {
    grid-template-columns: 1fr;
  }
  
  .payment-methods {
    flex-direction: column;
  }
  
  .btn {
    width: 100%;
    margin: 5px 0;
  }
  
  .tabs {
    flex-direction: column;
  }
  
  .tab {
    text-align: center;
  }
  
  .form-grid {
    grid-template-columns: 1fr;
  }
  
  .seat-map {
    grid-template-columns: repeat(5, 1fr);
  }
}
</style>
</head>
<body>

<header>
  <h1>üöÜ H·ªÜ TH·ªêNG QU·∫¢N L√ù V√â T√ÄU</h1>
  <p>ƒê·∫∑t v√© nhanh ch√≥ng - Di chuy·ªÉn d·ªÖ d√†ng</p>
</header>

<div class="container">

<!-- üîê ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω -->
<div id="loginScreen">
  <div class="auth-container">
    <div class="auth-card">
      <h2>ƒêƒÉng nh·∫≠p h·ªá th·ªëng</h2>
      <p>Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c s·ª≠ d·ª•ng d·ªãch v·ª•</p>
      
      <div class="form-group">
        <label for="username">T√™n ƒëƒÉng nh·∫≠p</label>
        <input id="username" placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p" value="admin">
      </div>
      
      <div class="form-group">
        <label for="password">M·∫≠t kh·∫©u</label>
        <input id="password" type="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" value="123">
      </div>
      
      <button class="btn" onclick="login()">ƒêƒÉng nh·∫≠p</button>
      
      <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
        <p style="color: var(--gray); margin-bottom: 15px;">Ch∆∞a c√≥ t√†i kho·∫£n?</p>
        <button class="btn btn-secondary" onclick="showRegister()">ƒêƒÉng k√Ω t√†i kho·∫£n m·ªõi</button>
      </div>
      
      <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
        <p style="color: var(--gray); font-size: 0.9rem;">
          <strong>T√†i kho·∫£n demo:</strong><br>
          Qu·∫£n tr·ªã vi√™n: <strong>admin</strong> / <strong>123</strong><br>
          Kh√°ch h√†ng: <strong>user</strong> / <strong>123</strong>
        </p>
      </div>
    </div>
  </div>
</div>

<!-- üìù ƒêƒÉng k√Ω -->
<div id="registerScreen" class="hidden">
  <div class="auth-container">
    <div class="auth-card">
      <h2>ƒêƒÉng k√Ω t√†i kho·∫£n</h2>
      <p>T·∫°o t√†i kho·∫£n m·ªõi ƒë·ªÉ s·ª≠ d·ª•ng h·ªá th·ªëng</p>
      
      <div class="form-group">
        <label for="regUsername">T√™n ƒëƒÉng nh·∫≠p</label>
        <input id="regUsername" placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p">
      </div>
      
      <div class="form-group">
        <label for="regPassword">M·∫≠t kh·∫©u</label>
        <input id="regPassword" type="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
      </div>
      
      <div class="form-group">
        <label for="regConfirmPassword">X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
        <input id="regConfirmPassword" type="password" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u">
      </div>
      
      <div class="form-group">
        <label for="regFullName">H·ªç v√† t√™n</label>
        <input id="regFullName" placeholder="Nh·∫≠p h·ªç v√† t√™n">
      </div>
      
      <div class="form-group">
        <label for="regEmail">Email</label>
        <input id="regEmail" type="email" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ email">
      </div>
      
      <div class="form-group">
        <label for="regPhone">S·ªë ƒëi·ªán tho·∫°i</label>
        <input id="regPhone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
      </div>
      
      <button class="btn btn-success" onclick="register()">ƒêƒÉng k√Ω</button>
      
      <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
        <p style="color: var(--gray);">ƒê√£ c√≥ t√†i kho·∫£n?</p>
        <button class="btn" onclick="showLogin()">Quay l·∫°i ƒëƒÉng nh·∫≠p</button>
      </div>
    </div>
  </div>
</div>

<!-- üë§ Giao di·ªán kh√°ch h√†ng -->
<div id="userScreen" class="hidden">
  <div class="card">
    <div class="card-header">
      <h3>Xin ch√†o, <span id="userName"></span>!</h3>
      <button class="btn btn-danger" onclick="logout()">ƒêƒÉng xu·∫•t</button>
    </div>
    <p>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi h·ªá th·ªëng ƒë·∫∑t v√© t√†u. D∆∞·ªõi ƒë√¢y l√† c√°c ch·ª©c nƒÉng c√≥ s·∫µn:</p>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="switchTab('datVeTab')">üéüÔ∏è ƒê·∫∑t v√©</div>
    <div class="tab" onclick="switchTab('veDaDatTab')">üìã V√© ƒë√£ ƒë·∫∑t</div>
    <div class="tab" onclick="switchTab('thongTinTab')">üë§ Th√¥ng tin</div>
  </div>

  <div id="datVeTab" class="tab-content active">
    <div class="card">
      <h3>üéüÔ∏è ƒê·∫∑t v√© t√†u</h3>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="chonChuyen">Ch·ªçn chuy·∫øn t√†u</label>
          <select id="chonChuyen"></select>
        </div>
        <div class="form-group">
          <label for="soGhe">S·ªë gh·∫ø</label>
          <input id="soGhe" placeholder="VD: A01, B12" list="seatSuggestions">
          <datalist id="seatSuggestions">
            <option value="A01">
            <option value="A02">
            <option value="B01">
            <option value="B02">
            <option value="C01">
            <option value="C02">
          </datalist>
        </div>
      </div>
      
      <div class="form-group">
        <label for="giaVe">Gi√° v√© (VNƒê)</label>
        <input id="giaVe" type="number" placeholder="Nh·∫≠p gi√° v√©" readonly>
      </div>
      
      <div id="seatSelection" class="hidden">
        <h4>Ch·ªçn gh·∫ø tr·ª±c quan:</h4>
        <div class="seat-map" id="seatMap"></div>
      </div>
      
      <button class="btn btn-success" onclick="datVe()">ƒê·∫∑t v√© ngay</button>
    </div>
  </div>

  <div id="veDaDatTab" class="tab-content">
    <div class="card">
      <h3>üìã V√© ƒë√£ ƒë·∫∑t</h3>
      <div style="margin-bottom: 15px;">
        <button class="btn btn-sm" onclick="filterTickets('all')">T·∫•t c·∫£</button>
        <button class="btn btn-sm btn-warning" onclick="filterTickets('pending')">Ch∆∞a thanh to√°n</button>
        <button class="btn btn-sm btn-success" onclick="filterTickets('paid')">ƒê√£ thanh to√°n</button>
      </div>
      <table id="bangVe">
        <thead>
          <tr>
            <th>Chuy·∫øn</th>
            <th>Gh·∫ø</th>
            <th>Gi√° (VNƒê)</th>
            <th>Ng√†y ƒë·∫∑t</th>
            <th>Tr·∫°ng th√°i</th>
            <th>H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div id="thongTinTab" class="tab-content">
    <div class="card">
      <h3>üë§ Th√¥ng tin t√†i kho·∫£n</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="infoUsername">T√™n ƒëƒÉng nh·∫≠p</label>
          <input id="infoUsername" readonly>
        </div>
        <div class="form-group">
          <label for="infoFullName">H·ªç v√† t√™n</label>
          <input id="infoFullName">
        </div>
        <div class="form-group">
          <label for="infoEmail">Email</label>
          <input id="infoEmail" type="email">
        </div>
        <div class="form-group">
          <label for="infoPhone">S·ªë ƒëi·ªán tho·∫°i</label>
          <input id="infoPhone">
        </div>
      </div>
      <button class="btn btn-success" onclick="updateProfile()">C·∫≠p nh·∫≠t th√¥ng tin</button>
      
      <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
        <h4>Th·ªëng k√™ c√° nh√¢n</h4>
        <div class="stats-container">
          <div class="stat-card">
            <h4>T·ªïng s·ªë v√©</h4>
            <div class="value" id="totalTickets">0</div>
          </div>
          <div class="stat-card">
            <h4>ƒê√£ thanh to√°n</h4>
            <div class="value" id="paidTickets">0</div>
          </div>
          <div class="stat-card">
            <h4>T·ªïng chi ti√™u</h4>
            <div class="value" id="totalSpent">0</div>
            <p>VNƒê</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- üí≥ Thanh to√°n -->
<div id="paymentScreen" class="hidden">
  <div class="card" style="text-align:center;">
    <h3>üí≥ Thanh to√°n v√© t√†u</h3>
    <p>Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n:</p>
    
    <div class="payment-methods">
      <div class="payment-method" onclick="selectPayment('credit')">
        <i>üí≥</i>
        <p>Th·∫ª t√≠n d·ª•ng</p>
      </div>
      <div class="payment-method" onclick="selectPayment('transfer')">
        <i>üè¶</i>
        <p>Chuy·ªÉn kho·∫£n</p>
      </div>
      <div class="payment-method" onclick="selectPayment('cash')">
        <i>üíµ</i>
        <p>Ti·ªÅn m·∫∑t</p>
      </div>
    </div>
    
    <div id="paymentDetails" class="hidden" style="margin: 20px 0; text-align: left;">
      <h4>Th√¥ng tin thanh to√°n:</h4>
      <p><strong>Chuy·∫øn t√†u:</strong> <span id="payTrip"></span></p>
      <p><strong>S·ªë gh·∫ø:</strong> <span id="paySeat"></span></p>
      <p><strong>S·ªë ti·ªÅn:</strong> <span id="payAmount"></span> VNƒê</p>
      <p><strong>Ph∆∞∆°ng th·ª©c:</strong> <span id="payMethod"></span></p>
    </div>
    
    <button class="btn btn-success" onclick="confirmPay()" id="confirmPayBtn">X√°c nh·∫≠n thanh to√°n</button>
    <button class="btn" onclick="backToUser()">Quay l·∫°i</button>
  </div>
</div>

<!-- üõ†Ô∏è Trang qu·∫£n tr·ªã -->
<div id="adminScreen" class="hidden">
  <div class="card">
    <div class="card-header">
      <h3>üõ†Ô∏è Qu·∫£n tr·ªã h·ªá th·ªëng</h3>
      <button class="btn btn-danger" onclick="logout()">ƒêƒÉng xu·∫•t</button>
    </div>
    <p>Ch√†o m·ª´ng qu·∫£n tr·ªã vi√™n! D∆∞·ªõi ƒë√¢y l√† c√°c c√¥ng c·ª• qu·∫£n l√Ω h·ªá th·ªëng.</p>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="switchAdminTab('quanLyChuyenTab')">üöÜ Qu·∫£n l√Ω chuy·∫øn</div>
    <div class="tab" onclick="switchAdminTab('quanLyUserTab')">üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</div>
    <div class="tab" onclick="switchAdminTab('caiDatTab')">‚öôÔ∏è C√†i ƒë·∫∑t h·ªá th·ªëng</div>
    <div class="tab" onclick="switchAdminTab('thongKeTab')">üìä Th·ªëng k√™</div>
  </div>

  <div id="quanLyChuyenTab" class="tab-content active">
    <div class="card">
      <h3>üìã Qu·∫£n l√Ω chuy·∫øn t√†u</h3>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="soHieu">S·ªë hi·ªáu t√†u</label>
          <input id="soHieu" placeholder="VD: SE1, TN2">
        </div>
        <div class="form-group">
          <label for="tuyen">Tuy·∫øn ƒë∆∞·ªùng</label>
          <input id="tuyen" placeholder="VD: H√† N·ªôi - S√†i G√≤n">
        </div>
        <div class="form-group">
          <label for="gia">Gi√° v√© (VNƒê)</label>
          <input id="gia" type="number" placeholder="Nh·∫≠p gi√° v√©">
        </div>
      </div>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="gioKhoiHanh">Gi·ªù kh·ªüi h√†nh</label>
          <input id="gioKhoiHanh" type="time" value="08:00">
        </div>
        <div class="form-group">
          <label for="soLuongGhe">S·ªë l∆∞·ª£ng gh·∫ø</label>
          <input id="soLuongGhe" type="number" placeholder="S·ªë gh·∫ø" value="50">
        </div>
        <div class="form-group">
          <label for="trangThaiTau">Tr·∫°ng th√°i t√†u</label>
          <select id="trangThaiTau">
            <option value="ƒêang ho·∫°t ƒë·ªông">ƒêang ho·∫°t ƒë·ªông</option>
            <option value="T·∫°m d·ª´ng">T·∫°m d·ª´ng</option>
            <option value="B·∫£o tr√¨">B·∫£o tr√¨</option>
            <option value="H·ªßy">H·ªßy</option>
          </select>
        </div>
      </div>
      
      <button class="btn btn-success" onclick="themChuyenTau()">Th√™m chuy·∫øn t√†u</button>
    </div>

    <div class="card">
      <h3>üìã Danh s√°ch chuy·∫øn t√†u</h3>
      <table id="bangChuyen">
        <thead>
          <tr>
            <th>S·ªë hi·ªáu</th>
            <th>Tuy·∫øn</th>
            <th>Gi·ªù kh·ªüi h√†nh</th>
            <th>S·ªë gh·∫ø</th>
            <th>Gi√° (VNƒê)</th>
            <th>Tr·∫°ng th√°i</th>
            <th>H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div id="quanLyUserTab" class="tab-content">
    <div class="card">
      <h3>üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h3>
      <table id="bangUsers">
        <thead>
          <tr>
            <th>T√™n ƒëƒÉng nh·∫≠p</th>
            <th>H·ªç t√™n</th>
            <th>Email</th>
            <th>S·ªë ƒëi·ªán tho·∫°i</th>
            <th>Vai tr√≤</th>
            <th>Tr·∫°ng th√°i</th>
            <th>H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div id="caiDatTab" class="tab-content">
    <div class="card">
      <h3>‚öôÔ∏è C√†i ƒë·∫∑t h·ªá th·ªëng</h3>
      
      <div class="form-group">
        <label for="tenCongTy">T√™n c√¥ng ty</label>
        <input id="tenCongTy" value="C√¥ng ty ƒê∆∞·ªùng s·∫Øt Vi·ªát Nam">
      </div>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="phiDichVu">Ph√≠ d·ªãch v·ª• (%)</label>
          <input id="phiDichVu" type="number" value="5" min="0" max="20">
        </div>
        <div class="form-group">
          <label for="thoiGianHuyVe">Th·ªùi gian h·ªßy v√© (ph√∫t)</label>
          <input id="thoiGianHuyVe" type="number" value="30" min="0">
        </div>
      </div>
      
      <div class="form-group">
        <label for="thongBaoHeThong">Th√¥ng b√°o h·ªá th·ªëng</label>
        <textarea id="thongBaoHeThong" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; min-height: 100px;" placeholder="Nh·∫≠p th√¥ng b√°o h·ªá th·ªëng..."></textarea>
      </div>
      
      <button class="btn btn-success" onclick="luuCaiDat()">L∆∞u c√†i ƒë·∫∑t</button>
    </div>
  </div>

  <div id="thongKeTab" class="tab-content">
    <div class="card">
      <h3>üìä Th·ªëng k√™ doanh thu</h3>
      <div class="stats-container">
        <div class="stat-card">
          <h4>T·ªïng s·ªë v√©</h4>
          <div class="value" id="soVe">0</div>
        </div>
        <div class="stat-card">
          <h4>Doanh thu</h4>
          <div class="value" id="tongTien">0</div>
          <p>VNƒê</p>
        </div>
        <div class="stat-card">
          <h4>V√© ch∆∞a thanh to√°n</h4>
          <div class="value" id="veChuaThanhToan">0</div>
        </div>
        <div class="stat-card">
          <h4>V√© ƒë√£ thanh to√°n</h4>
          <div class="value" id="veDaThanhToan">0</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>üìà Top chuy·∫øn t√†u ph·ªï bi·∫øn</h3>
      <table id="topChuyenTau">
        <thead>
          <tr>
            <th>Chuy·∫øn t√†u</th>
            <th>S·ªë v√© b√°n</th>
            <th>Doanh thu</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

</div>

<div id="notification" class="notification"></div>

<script>
// ======================= D·ªÆ LI·ªÜU =======================
let users = JSON.parse(localStorage.getItem("users") || "[]");
let chuyenTau = JSON.parse(localStorage.getItem("chuyenTau") || "[]");
let veTau = JSON.parse(localStorage.getItem("veTau") || "[]");
let caiDat = JSON.parse(localStorage.getItem("caiDat") || '{"tenCongTy":"C√¥ng ty ƒê∆∞·ªùng s·∫Øt Vi·ªát Nam","phiDichVu":5,"thoiGianHuyVe":30,"thongBaoHeThong":"Ch√†o m·ª´ng ƒë·∫øn v·ªõi h·ªá th·ªëng ƒë·∫∑t v√© t√†u!"}');
let currentUser = JSON.parse(localStorage.getItem("loggedInUser") || "null");
let payIndex = null;
let selectedPaymentMethod = null;
let currentTicketFilter = 'all';

// Kh·ªüi t·∫°o d·ªØ li·ªáu m·∫´u n·∫øu ch∆∞a c√≥
function initializeData() {
  if (users.length === 0) {
    users = [
      { 
        user: "admin", 
        pass: "123", 
        role: "admin",
        fullName: "Qu·∫£n tr·ªã vi√™n",
        email: "admin@railway.com",
        phone: "0123456789",
        status: "active",
        createdAt: new Date().toISOString()
      },
      { 
        user: "user", 
        pass: "123", 
        role: "user",
        fullName: "Ng∆∞·ªùi d√πng Demo",
        email: "user@example.com",
        phone: "0987654321",
        status: "active",
        createdAt: new Date().toISOString()
      }
    ];
    localStorage.setItem("users", JSON.stringify(users));
  }

  if (chuyenTau.length === 0) {
    chuyenTau = [
      { 
        soHieu: "SE1", 
        tuyen: "H√† N·ªôi - S√†i G√≤n", 
        gia: "500000", 
        gioKhoiHanh: "08:00", 
        soLuongGhe: 50, 
        trangThai: "ƒêang ho·∫°t ƒë·ªông",
        createdAt: new Date().toISOString()
      },
      { 
        soHieu: "SE2", 
        tuyen: "S√†i G√≤n - H√† N·ªôi", 
        gia: "500000", 
        gioKhoiHanh: "14:00", 
        soLuongGhe: 50, 
        trangThai: "ƒêang ho·∫°t ƒë·ªông",
        createdAt: new Date().toISOString()
      },
      { 
        soHieu: "TN1", 
        tuyen: "H√† N·ªôi - H·∫£i Ph√≤ng", 
        gia: "150000", 
        gioKhoiHanh: "07:30", 
        soLuongGhe: 40, 
        trangThai: "ƒêang ho·∫°t ƒë·ªông",
        createdAt: new Date().toISOString()
      },
      { 
        soHieu: "TN2", 
        tuyen: "H·∫£i Ph√≤ng - H√† N·ªôi", 
        gia: "150000", 
        gioKhoiHanh: "16:00", 
        soLuongGhe: 40, 
        trangThai: "T·∫°m d·ª´ng",
        createdAt: new Date().toISOString()
      }
    ];
    localStorage.setItem("chuyenTau", JSON.stringify(chuyenTau));
  }
}

// G·ªçi h√†m kh·ªüi t·∫°o d·ªØ li·ªáu
initializeData();

// ======================= HI·ªÇN TH·ªä TH√îNG B√ÅO =======================
function showNotification(message, type = "info") {
  const notification = document.getElementById("notification");
  notification.textContent = message;
  notification.className = `notification ${type}`;
  notification.classList.add("show");
  
  setTimeout(() => {
    notification.classList.remove("show");
  }, 3000);
}

// ======================= GIAO DI·ªÜN =======================
function show(screen) {
  ["loginScreen", "registerScreen", "userScreen", "paymentScreen", "adminScreen"].forEach(id => {
    document.getElementById(id).classList.add("hidden");
  });
  document.getElementById(screen).classList.remove("hidden");
}

function showRegister() {
  show("registerScreen");
}

function showLogin() {
  show("loginScreen");
}

function switchTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  
  document.getElementById(tabId).classList.add('active');
  
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  event.target.classList.add('active');
  
  if (tabId === 'veDaDatTab') {
    loadVe();
  } else if (tabId === 'thongTinTab') {
    loadUserInfo();
  } else if (tabId === 'datVeTab') {
    loadChuyenForUser();
  }
}

function switchAdminTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  
  document.getElementById(tabId).classList.add('active');
  
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  event.target.classList.add('active');
  
  if (tabId === 'thongKeTab') {
    loadAdminStats();
  } else if (tabId === 'caiDatTab') {
    loadCaiDat();
  } else if (tabId === 'quanLyUserTab') {
    loadUsers();
  }
}

// ======================= ƒêƒÇNG K√ù / ƒêƒÇNG NH·∫¨P =======================
function register() {
  const username = document.getElementById('regUsername').value.trim();
  const password = document.getElementById('regPassword').value.trim();
  const confirmPassword = document.getElementById('regConfirmPassword').value.trim();
  const fullName = document.getElementById('regFullName').value.trim();
  const email = document.getElementById('regEmail').value.trim();
  const phone = document.getElementById('regPhone').value.trim();
  
  if (!username || !password || !confirmPassword || !fullName || !email) {
    return showNotification("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!", "error");
  }
  
  if (password !== confirmPassword) {
    return showNotification("M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!", "error");
  }
  
  if (users.find(u => u.user === username)) {
    return showNotification("T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i!", "error");
  }
  
  if (users.find(u => u.email === email)) {
    return showNotification("Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng!", "error");
  }
  
  const newUser = {
    user: username,
    pass: password,
    role: "user",
    fullName: fullName,
    email: email,
    phone: phone,
    status: "active",
    createdAt: new Date().toISOString()
  };
  
  users.push(newUser);
  localStorage.setItem("users", JSON.stringify(users));
  
  showNotification("ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p.", "success");
  showLogin();
}

function login() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  
  console.log("ƒêang ƒëƒÉng nh·∫≠p v·ªõi:", username, password);
  console.log("Danh s√°ch users:", users);
  
  const user = users.find(u => u.user === username && u.pass === password);
  
  if (!user) {
    console.log("Kh√¥ng t√¨m th·∫•y user ho·∫∑c sai m·∫≠t kh·∫©u");
    return showNotification("Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!", "error");
  }
  
  // S·ª¨A L·ªñI: Ch·ªâ ki·ªÉm tra status cho user th∆∞·ªùng, admin lu√¥n ƒë∆∞·ª£c ƒëƒÉng nh·∫≠p
  if (user.role !== "admin" && user.status !== "active") {
    return showNotification("T√†i kho·∫£n ƒë√£ b·ªã kh√≥a!", "error");
  }
  
  currentUser = user;
  localStorage.setItem("loggedInUser", JSON.stringify(user));
  
  console.log("ƒêƒÉng nh·∫≠p th√†nh c√¥ng:", user);
  
  if (user.role === "admin") {
    loadAdmin();
    showNotification(`Ch√†o m·ª´ng qu·∫£n tr·ªã vi√™n ${user.fullName || user.user}!`, "success");
  } else {
    loadUser();
    showNotification(`Ch√†o m·ª´ng ${user.fullName || user.user} ƒë·∫øn v·ªõi h·ªá th·ªëng!`, "success");
  }
}

function logout() {
  localStorage.removeItem("loggedInUser");
  currentUser = null;
  show("loginScreen");
  showNotification("ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng!", "info");
}

// ======================= NG∆Ø·ªúI D√ôNG =======================
function loadUser() {
  show("userScreen");
  document.getElementById('userName').textContent = currentUser.fullName || currentUser.user;
  loadUserInfo();
  loadChuyenForUser();
  loadVe();
}

function loadChuyenForUser() {
  const chonChuyen = document.getElementById('chonChuyen');
  const activeTrains = chuyenTau.filter(c => c.trangThai === "ƒêang ho·∫°t ƒë·ªông");
  
  chonChuyen.innerHTML = activeTrains.map(c => 
    `<option value="${c.soHieu} - ${c.tuyen}" data-gia="${c.gia}">${c.soHieu} - ${c.tuyen} (${parseInt(c.gia).toLocaleString()} VNƒê) - ${c.gioKhoiHanh}</option>`
  ).join("");
  
  chonChuyen.addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];
    const gia = selectedOption.getAttribute('data-gia');
    document.getElementById('giaVe').value = gia;
    
    // Hi·ªÉn th·ªã b·∫£n ƒë·ªì gh·∫ø
    generateSeatMap();
  });
  
  if (chonChuyen.options.length > 0) {
    const gia = chonChuyen.options[0].getAttribute('data-gia');
    document.getElementById('giaVe').value = gia;
    generateSeatMap();
  }
}

function generateSeatMap() {
  const seatMap = document.getElementById('seatMap');
  const selectedTrain = document.getElementById('chonChuyen').value;
  
  if (!selectedTrain) {
    document.getElementById('seatSelection').classList.add('hidden');
    return;
  }
  
  // L·∫•y th√¥ng tin chuy·∫øn t√†u
  const train = chuyenTau.find(c => `${c.soHieu} - ${c.tuyen}` === selectedTrain);
  if (!train) return;
  
  // T·∫°o b·∫£n ƒë·ªì gh·∫ø
  seatMap.innerHTML = '';
  const rows = Math.ceil(train.soLuongGhe / 10);
  let seatNumber = 1;
  
  for (let i = 0; i < rows; i++) {
    for (let j = 0; j < 10; j++) {
      if (seatNumber > train.soLuongGhe) break;
      
      const seatCode = `${String.fromCharCode(65 + i)}${seatNumber.toString().padStart(2, '0')}`;
      const isOccupied = veTau.some(v => v.chuyen === selectedTrain && v.ghe === seatCode);
      
      const seat = document.createElement('div');
      seat.className = `seat ${isOccupied ? 'occupied' : ''}`;
      seat.textContent = seatNumber;
      seat.title = `Gh·∫ø ${seatCode}`;
      
      if (!isOccupied) {
        seat.addEventListener('click', () => {
          document.querySelectorAll('.seat').forEach(s => s.classList.remove('selected'));
          seat.classList.add('selected');
          document.getElementById('soGhe').value = seatCode;
        });
      }
      
      seatMap.appendChild(seat);
      seatNumber++;
    }
  }
  
  document.getElementById('seatSelection').classList.remove('hidden');
}

function loadUserInfo() {
  document.getElementById('infoUsername').value = currentUser.user;
  document.getElementById('infoFullName').value = currentUser.fullName || '';
  document.getElementById('infoEmail').value = currentUser.email || '';
  document.getElementById('infoPhone').value = currentUser.phone || '';
  
  // Th·ªëng k√™ c√° nh√¢n
  const userTickets = veTau.filter(v => v.nguoi === currentUser.user);
  const paidTickets = userTickets.filter(v => v.trangThai === "ƒê√£ thanh to√°n");
  const totalSpent = paidTickets.reduce((sum, v) => sum + parseInt(v.gia), 0);
  
  document.getElementById('totalTickets').textContent = userTickets.length;
  document.getElementById('paidTickets').textContent = paidTickets.length;
  document.getElementById('totalSpent').textContent = totalSpent.toLocaleString();
}

function updateProfile() {
  const fullName = document.getElementById('infoFullName').value.trim();
  const email = document.getElementById('infoEmail').value.trim();
  const phone = document.getElementById('infoPhone').value.trim();
  
  if (!fullName || !email) {
    return showNotification("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!", "error");
  }
  
  // C·∫≠p nh·∫≠t th√¥ng tin ng∆∞·ªùi d√πng
  const userIndex = users.findIndex(u => u.user === currentUser.user);
  if (userIndex !== -1) {
    users[userIndex].fullName = fullName;
    users[userIndex].email = email;
    users[userIndex].phone = phone;
    
    // C·∫≠p nh·∫≠t currentUser
    currentUser.fullName = fullName;
    currentUser.email = email;
    currentUser.phone = phone;
    
    localStorage.setItem("users", JSON.stringify(users));
    localStorage.setItem("loggedInUser", JSON.stringify(currentUser));
    
    showNotification("C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!", "success");
    loadUserInfo();
  }
}

function datVe() {
  const ch = document.getElementById('chonChuyen').value;
  const ghe = document.getElementById('soGhe').value;
  const gia = document.getElementById('giaVe').value;
  
  if (!ch || !ghe || !gia) return showNotification("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!", "error");
  
  // Ki·ªÉm tra gh·∫ø ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t ch∆∞a
  const existingSeat = veTau.find(v => v.chuyen === ch && v.ghe === ghe);
  if (existingSeat) return showNotification("Gh·∫ø n√†y ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t! Vui l√≤ng ch·ªçn gh·∫ø kh√°c.", "error");
  
  veTau.push({ 
    nguoi: currentUser.user, 
    chuyen: ch, 
    ghe, 
    gia, 
    trangThai: "Ch∆∞a thanh to√°n",
    ngayDat: new Date().toLocaleDateString('vi-VN'),
    createdAt: new Date().toISOString()
  });
  
  localStorage.setItem("veTau", JSON.stringify(veTau));
  showNotification("ƒê·∫∑t v√© th√†nh c√¥ng! Vui l√≤ng thanh to√°n ƒë·ªÉ x√°c nh·∫≠n.", "success");
  loadVe();
  generateSeatMap();
  
  // Reset form
  document.getElementById('soGhe').value = "";
  document.querySelectorAll('.seat').forEach(s => s.classList.remove('selected'));
}

function filterTickets(filter) {
  currentTicketFilter = filter;
  loadVe();
}

function loadVe() {
  const tb = document.querySelector("#bangVe tbody");
  let userTickets = veTau.filter(v => v.nguoi === currentUser.user);
  
  // L·ªçc theo tr·∫°ng th√°i
  if (currentTicketFilter === 'pending') {
    userTickets = userTickets.filter(v => v.trangThai === "Ch∆∞a thanh to√°n");
  } else if (currentTicketFilter === 'paid') {
    userTickets = userTickets.filter(v => v.trangThai === "ƒê√£ thanh to√°n");
  }
  
  tb.innerHTML = "";
  
  if (userTickets.length === 0) {
    tb.innerHTML = `<tr><td colspan="6" style="text-align: center;">Kh√¥ng c√≥ v√© n√†o.</td></tr>`;
    return;
  }
  
  userTickets.forEach((v, i) => {
    const statusClass = v.trangThai === "ƒê√£ thanh to√°n" ? "status-confirmed" : "status-pending";
    
    tb.innerHTML += `
      <tr>
        <td>${v.chuyen}</td>
        <td>${v.ghe}</td>
        <td>${parseInt(v.gia).toLocaleString()}</td>
        <td>${v.ngayDat}</td>
        <td><span class="status-badge ${statusClass}">${v.trangThai}</span></td>
        <td>
          ${v.trangThai === "Ch∆∞a thanh to√°n" ? 
            `<button class="btn btn-sm btn-warning" onclick="mothanhToan(${i})">Thanh to√°n</button>
             <button class="btn btn-sm btn-danger" onclick="huyVe(${i})">H·ªßy v√©</button>` : 
            `<span class="status-badge status-paid">ƒê√£ x√°c nh·∫≠n</span>`
          }
        </td>
      </tr>`;
  });
}

function huyVe(index) {
  if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy v√© n√†y?")) {
    veTau.splice(index, 1);
    localStorage.setItem("veTau", JSON.stringify(veTau));
    showNotification("ƒê√£ h·ªßy v√© th√†nh c√¥ng!", "success");
    loadVe();
    generateSeatMap();
  }
}

function mothanhToan(i) {
  payIndex = i;
  const ticket = veTau[payIndex];
  
  document.getElementById('payTrip').textContent = ticket.chuyen;
  document.getElementById('paySeat').textContent = ticket.ghe;
  document.getElementById('payAmount').textContent = parseInt(ticket.gia).toLocaleString();
  
  show("paymentScreen");
}

function backToUser() {
  payIndex = null;
  selectedPaymentMethod = null;
  document.querySelectorAll('.payment-method').forEach(method => {
    method.classList.remove('selected');
  });
  document.getElementById('paymentDetails').classList.add('hidden');
  document.getElementById('confirmPayBtn').disabled = true;
  
  show("userScreen");
}

// ======================= THANH TO√ÅN =======================
function selectPayment(method) {
  selectedPaymentMethod = method;
  
  document.querySelectorAll('.payment-method').forEach(m => {
    m.classList.remove('selected');
  });
  event.target.closest('.payment-method').classList.add('selected');
  
  document.getElementById('paymentDetails').classList.remove('hidden');
  
  let methodText = "";
  switch(method) {
    case 'credit': methodText = "Th·∫ª t√≠n d·ª•ng"; break;
    case 'transfer': methodText = "Chuy·ªÉn kho·∫£n ng√¢n h√†ng"; break;
    case 'cash': methodText = "Ti·ªÅn m·∫∑t"; break;
  }
  document.getElementById('payMethod').textContent = methodText;
  
  document.getElementById('confirmPayBtn').disabled = false;
}

function confirmPay() {
  if (payIndex !== null && selectedPaymentMethod) {
    const btn = document.getElementById('confirmPayBtn');
    const originalText = btn.innerHTML;
    btn.innerHTML = '<span class="loading"></span> ƒêang x·ª≠ l√Ω...';
    btn.disabled = true;
    
    setTimeout(() => {
      veTau[payIndex].trangThai = "ƒê√£ thanh to√°n";
      veTau[payIndex].phuongThuc = selectedPaymentMethod;
      veTau[payIndex].ngayThanhToan = new Date().toLocaleDateString('vi-VN');
      
      localStorage.setItem("veTau", JSON.stringify(veTau));
      
      btn.innerHTML = originalText;
      showNotification("Thanh to√°n th√†nh c√¥ng! V√© c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c x√°c nh·∫≠n.", "success");
      
      show("userScreen");
      loadVe();
      loadUserInfo();
      generateSeatMap();
      
      payIndex = null;
      selectedPaymentMethod = null;
    }, 1500);
  }
}

// ======================= ADMIN =======================
function loadAdmin() {
  show("adminScreen");
  loadChuyen();
  loadAdminStats();
  loadCaiDat();
  loadUsers();
}

function loadCaiDat() {
  document.getElementById('tenCongTy').value = caiDat.tenCongTy;
  document.getElementById('phiDichVu').value = caiDat.phiDichVu;
  document.getElementById('thoiGianHuyVe').value = caiDat.thoiGianHuyVe;
  document.getElementById('thongBaoHeThong').value = caiDat.thongBaoHeThong || '';
}

function luuCaiDat() {
  caiDat.tenCongTy = document.getElementById('tenCongTy').value;
  caiDat.phiDichVu = parseInt(document.getElementById('phiDichVu').value);
  caiDat.thoiGianHuyVe = parseInt(document.getElementById('thoiGianHuyVe').value);
  caiDat.thongBaoHeThong = document.getElementById('thongBaoHeThong').value;
  
  localStorage.setItem("caiDat", JSON.stringify(caiDat));
  showNotification("ƒê√£ l∆∞u c√†i ƒë·∫∑t h·ªá th·ªëng!", "success");
}

function themChuyenTau() {
  const soHieuVal = document.getElementById('soHieu').value.trim();
  const tuyenVal = document.getElementById('tuyen').value.trim();
  const giaVal = document.getElementById('gia').value.trim();
  const gioKhoiHanhVal = document.getElementById('gioKhoiHanh').value;
  const soLuongGheVal = document.getElementById('soLuongGhe').value;
  const trangThaiVal = document.getElementById('trangThaiTau').value;
  
  if (!soHieuVal || !tuyenVal || !giaVal) {
    return showNotification("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!", "error");
  }
  
  if (chuyenTau.find(c => c.soHieu === soHieuVal)) {
    return showNotification("S·ªë hi·ªáu t√†u ƒë√£ t·ªìn t·∫°i!", "error");
  }
  
  chuyenTau.push({ 
    soHieu: soHieuVal, 
    tuyen: tuyenVal, 
    gia: giaVal,
    gioKhoiHanh: gioKhoiHanhVal,
    soLuongGhe: soLuongGheVal,
    trangThai: trangThaiVal,
    createdAt: new Date().toISOString()
  });
  
  localStorage.setItem("chuyenTau", JSON.stringify(chuyenTau));
  
  showNotification("Th√™m chuy·∫øn t√†u th√†nh c√¥ng!", "success");
  loadChuyen();
  
  // Reset form
  document.getElementById('soHieu').value = "";
  document.getElementById('tuyen').value = "";
  document.getElementById('gia').value = "";
}

function loadChuyen() {
  const tb = document.querySelector("#bangChuyen tbody");
  tb.innerHTML = "";
  
  if (chuyenTau.length === 0) {
    tb.innerHTML = `<tr><td colspan="7" style="text-align: center;">Ch∆∞a c√≥ chuy·∫øn t√†u n√†o.</td></tr>`;
    return;
  }
  
  chuyenTau.forEach((c, i) => {
    const statusClass = c.trangThai === "ƒêang ho·∫°t ƒë·ªông" ? "status-active" : 
                       c.trangThai === "T·∫°m d·ª´ng" ? "status-pending" : "status-inactive";
    
    tb.innerHTML += `
      <tr>
        <td>${c.soHieu}</td>
        <td>${c.tuyen}</td>
        <td>${c.gioKhoiHanh}</td>
        <td>${c.soLuongGhe}</td>
        <td>${parseInt(c.gia).toLocaleString()}</td>
        <td><span class="status-badge ${statusClass}">${c.trangThai}</span></td>
        <td>
          <button class="btn btn-sm btn-warning" onclick="thayDoiTrangThai(${i})">ƒê·ªïi tr·∫°ng th√°i</button>
          <button class="btn btn-sm btn-danger" onclick="xoaChuyenTau(${i})">X√≥a</button>
        </td>
      </tr>`;
  });
}

function thayDoiTrangThai(index) {
  const currentStatus = chuyenTau[index].trangThai;
  const statuses = ["ƒêang ho·∫°t ƒë·ªông", "T·∫°m d·ª´ng", "B·∫£o tr√¨", "H·ªßy"];
  const currentIndex = statuses.indexOf(currentStatus);
  const nextIndex = (currentIndex + 1) % statuses.length;
  
  chuyenTau[index].trangThai = statuses[nextIndex];
  localStorage.setItem("chuyenTau", JSON.stringify(chuyenTau));
  showNotification(`ƒê√£ thay ƒë·ªïi tr·∫°ng th√°i th√†nh: ${statuses[nextIndex]}`, "success");
  loadChuyen();
}

function xoaChuyenTau(index) {
  if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a chuy·∫øn t√†u n√†y?")) {
    // Ki·ªÉm tra xem c√≥ v√© n√†o ƒëang s·ª≠ d·ª•ng chuy·∫øn t√†u n√†y kh√¥ng
    const train = chuyenTau[index];
    const trainTickets = veTau.filter(v => v.chuyen === `${train.soHieu} - ${train.tuyen}`);
    
    if (trainTickets.length > 0) {
      return showNotification("Kh√¥ng th·ªÉ x√≥a chuy·∫øn t√†u ƒëang c√≥ v√© ƒë√£ ƒë·∫∑t!", "error");
    }
    
    chuyenTau.splice(index, 1);
    localStorage.setItem("chuyenTau", JSON.stringify(chuyenTau));
    showNotification("ƒê√£ x√≥a chuy·∫øn t√†u!", "success");
    loadChuyen();
  }
}

function loadUsers() {
  const tb = document.querySelector("#bangUsers tbody");
  tb.innerHTML = "";
  
  users.forEach((u, i) => {
    if (u.user === "admin") return; // Kh√¥ng hi·ªÉn th·ªã t√†i kho·∫£n admin
    
    const statusClass = u.status === "active" ? "status-active" : "status-inactive";
    
    tb.innerHTML += `
      <tr>
        <td>${u.user}</td>
        <td>${u.fullName || 'Ch∆∞a c·∫≠p nh·∫≠t'}</td>
        <td>${u.email || 'Ch∆∞a c·∫≠p nh·∫≠t'}</td>
        <td>${u.phone || 'Ch∆∞a c·∫≠p nh·∫≠t'}</td>
        <td>${u.role === "admin" ? "Qu·∫£n tr·ªã vi√™n" : "Ng∆∞·ªùi d√πng"}</td>
        <td><span class="status-badge ${statusClass}">${u.status === "active" ? "Ho·∫°t ƒë·ªông" : "Kh√≥a"}</span></td>
        <td>
          <button class="btn btn-sm btn-warning" onclick="thayDoiTrangThaiUser(${i})">${u.status === "active" ? "Kh√≥a" : "M·ªü kh√≥a"}</button>
          <button class="btn btn-sm btn-danger" onclick="xoaUser(${i})">X√≥a</button>
        </td>
      </tr>`;
  });
}

function thayDoiTrangThaiUser(index) {
  users[index].status = users[index].status === "active" ? "inactive" : "active";
  localStorage.setItem("users", JSON.stringify(users));
  showNotification(`ƒê√£ ${users[index].status === "active" ? "m·ªü kh√≥a" : "kh√≥a"} t√†i kho·∫£n!`, "success");
  loadUsers();
}

function xoaUser(index) {
  if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y?")) {
    const username = users[index].user;
    
    // Ki·ªÉm tra xem ng∆∞·ªùi d√πng c√≥ v√© n√†o kh√¥ng
    const userTickets = veTau.filter(v => v.nguoi === username);
    if (userTickets.length > 0) {
      return showNotification("Kh√¥ng th·ªÉ x√≥a ng∆∞·ªùi d√πng ƒëang c√≥ v√© ƒë√£ ƒë·∫∑t!", "error");
    }
    
    users.splice(index, 1);
    localStorage.setItem("users", JSON.stringify(users));
    showNotification("ƒê√£ x√≥a ng∆∞·ªùi d√πng!", "success");
    loadUsers();
  }
}

function loadAdminStats() {
  const daDat = veTau.filter(v => v.trangThai === "ƒê√£ thanh to√°n");
  const chuaThanhToan = veTau.filter(v => v.trangThai === "Ch∆∞a thanh to√°n");
  
  document.getElementById('soVe').textContent = veTau.length;
  document.getElementById('tongTien').textContent = daDat.reduce((t, v) => t + parseInt(v.gia), 0).toLocaleString();
  document.getElementById('veChuaThanhToan').textContent = chuaThanhToan.length;
  document.getElementById('veDaThanhToan').textContent = daDat.length;
  
  // Top chuy·∫øn t√†u ph·ªï bi·∫øn
  const trainStats = {};
  veTau.forEach(v => {
    if (!trainStats[v.chuyen]) {
      trainStats[v.chuyen] = { count: 0, revenue: 0 };
    }
    trainStats[v.chuyen].count++;
    if (v.trangThai === "ƒê√£ thanh to√°n") {
      trainStats[v.chuyen].revenue += parseInt(v.gia);
    }
  });
  
  const topTrains = Object.entries(trainStats)
    .sort((a, b) => b[1].count - a[1].count)
    .slice(0, 5);
  
  const topTrainsTable = document.querySelector("#topChuyenTau tbody");
  topTrainsTable.innerHTML = "";
  
  if (topTrains.length === 0) {
    topTrainsTable.innerHTML = `<tr><td colspan="3" style="text-align: center;">Ch∆∞a c√≥ d·ªØ li·ªáu th·ªëng k√™.</td></tr>`;
    return;
  }
  
  topTrains.forEach(([train, stats]) => {
    topTrainsTable.innerHTML += `
      <tr>
        <td>${train}</td>
        <td>${stats.count}</td>
        <td>${stats.revenue.toLocaleString()} VNƒê</td>
      </tr>`;
  });
}

// ======================= KH·ªûI ƒê·ªòNG =======================
if (currentUser) {
  if (currentUser.role === "admin") loadAdmin();
  else loadUser();
} else {
  show("loginScreen");
}

// X·ª≠ l√Ω Enter ƒë·ªÉ ƒëƒÉng nh·∫≠p
document.getElementById('password')?.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    login();
  }
});

document.getElementById('regConfirmPassword')?.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    register();
  }
});
</script>
</body>
</html>